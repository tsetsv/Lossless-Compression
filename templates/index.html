<!DOCTYPE html>
<html lang="mn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lossless Compression Tool</title>
    <link rel="website icon" type="png" href="1f469-1f4bb.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        
    </style>
</head>

<body>
    <header>
        <div class="container">
            <h1>‚ú® –®–ê–•–ê–õ–¢–´–ù –ê–õ–ì–û–†–ò–¢–ú –¢–£–†–®–ò–ì–ß ‚ú®</h1>
        </div>
    </header>

    <div class="container">
        <div class="main-section">
            <div class="card">
                <h2>”®–≥”©–≥–¥”©–ª –æ—Ä—É—É–ª–∞—Ö</h2>
                <form id="compressionForm">
                    <div class="input-area">
                        <div class="input-group">
                            <label for="inputData">–¢–µ–∫—Å—Ç:</label>
                            <textarea id="inputData" placeholder="–®–∞—Ö–∞—Ö—ã–≥ —Ö“Ø—Å—Å—ç–Ω —Ç–µ–∫—Å—Ç—ç—ç —ç–Ω–¥ –±–∏—á–Ω—ç “Ø“Ø..."></textarea>
                        </div>

                        <div class="input-group">
                            <label for="inputFile">–≠—Å–≤—ç–ª –∑—É—Ä–∞–≥ –æ—Ä—É—É–ª–∞—Ö:</label>
                            <div class="file-upload">
                                <div class="icon">üìÅ</div>
                                <p>–≠–Ω–¥ –¥–∞—Ä–∂ —Ñ–∞–π–ª —Å–æ–Ω–≥–æ–Ω–æ —É—É</p>
                                <p style="font-size: 14px; opacity: 0.7;">(–ó”©–≤—Ö”©–Ω –∑—É—Ä–∞–≥: JPEG, PNG –≥.–º)</p>
                                <span class="file-name" id="fileName"></span>
                                <input type="file" id="inputFile">
                            </div>
                        </div>

                        <div class="input-group">
                            <label for="algorithm">–®–∞—Ö–∞–ª—Ç—ã–Ω –∞–ª–≥–æ—Ä–∏—Ç–º:</label>
                            <select id="algorithm">
                                <option value="runlength">Run-Length Encoding</option>
                                <option value="huffman">Huffman Coding</option>
                                <option value="lempelziv">Lempel-Ziv78</option>
                                <option value="arithmetic">Arithmetic Coding</option>
                                <option value="jpeg">Lossless JPEG</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-full pulse">
                        <span>–®–∞—Ö–∞–ª—Ç—ã–≥ —ç—Ö–ª“Ø“Ø–ª—ç—Ö</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M5 12h14"></path>
                            <path d="m12 5 7 7-7 7"></path>
                        </svg>
                    </button>
                </form>
            </div>

            <div class="card" id="output">
                <h2>–®–∞—Ö–∞–ª—Ç—ã–Ω “Ø—Ä –¥“Ø–Ω</h2>
                <div id="result">
                    <p style="text-align: center; margin: 40px 0; color: var(--gray);">”®–≥”©–≥–¥”©–ª –æ—Ä—É—É–ª–∂, —à–∞—Ö–∞–ª—Ç—ã–≥ —ç—Ö–ª“Ø“Ø–ª–Ω—ç “Ø“Ø.</p>
                </div>
                <div class="loader" id="loader"></div>
                <div class="result-area" id="resultArea" style="display: none;">
                    <div class="algorithm-badge" id="algorithmBadge">Run-Length Encoding</div>
                    <div class="result-container" id="resultContainer"></div>
                    
                    <div class="result-stats" id="resultStats">
                        <div class="stat-card">
                            <div class="value" id="originalSize">0</div>
                            <div class="label">–ê–Ω—Ö–Ω—ã —Ö—ç–º–∂—ç—ç (bytes)</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="compressedSize">0</div>
                            <div class="label">–®–∞—Ö—Å–∞–Ω—ã –¥–∞—Ä–∞–∞—Ö (bytes)</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="ratio">0</div>
                            <div class="label">–®–∞—Ö–∞–ª—Ç—ã–Ω —Ö–∞—Ä—å—Ü–∞–∞</div>
                        </div>
                    </div>

                    <div class="tree-visualization" id="treeVisualization" style="display: none;">
                        <h3 style="margin-bottom: 15px; color: var(--primary-dark);">–ö–æ–¥–ª–æ–ª—ã–Ω –º–æ–¥:</h3>
                        <div class="tree-container">
                            <pre id="treeContent"></pre>
                        </div>
                    </div>

                    <div class="explanation-section" id="explanationSection" style="display: none;">
                        <button class="explanation-toggle" id="explanationToggle">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 16v-4"></path>
                                <path d="M12 8h.01"></path>
                            </svg>
                            <span>–ê–ª–≥–æ—Ä–∏—Ç–º—ã–Ω —Ç–∞–π–ª–±–∞—Ä —Ö–∞—Ä–∞—Ö</span>
                        </button>
                        <div class="explanation-content" id="explanationContent"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>¬© 2025 Lossless Compression | –ë“Ø—Ö —ç—Ä—Ö –¶—ç—Ü—ç—ç–≥—ç—ç—Ä —Ö–∞–º–≥–∞–∞–ª–∞–≥–¥—Å–∞–Ω</p>
    </footer>

    <script>
        document.getElementById('inputFile').addEventListener('change', function(e) {
            const fileName = e.target.files[0] ? e.target.files[0].name : '';
            const fileNameEl = document.getElementById('fileName');
            
            if (fileName) {
                fileNameEl.textContent = fileName;
                fileNameEl.style.display = 'block';
            } else {
                fileNameEl.style.display = 'none';
            }
        });

        document.getElementById('explanationToggle').addEventListener('click', function() {
            const explanationContent = document.getElementById('explanationContent');
            const isVisible = explanationContent.style.display === 'block';
            
            explanationContent.style.display = isVisible ? 'none' : 'block';
            this.querySelector('span').textContent = isVisible 
                ? '–ê–ª–≥–æ—Ä–∏—Ç–º—ã–Ω —Ç–∞–π–ª–±–∞—Ä —Ö–∞—Ä–∞—Ö' 
                : '–ê–ª–≥–æ—Ä–∏—Ç–º—ã–Ω —Ç–∞–π–ª–±–∞—Ä —Ö–∞–∞—Ö';
        });

        document.getElementById('compressionForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const inputData = document.getElementById('inputData').value;
            const inputFile = document.getElementById('inputFile').files[0];
            const algorithm = document.getElementById('algorithm').value;
            const algorithmName = document.getElementById('algorithm').options[document.getElementById('algorithm').selectedIndex].text;

            let data = inputData;
            let inputSize = 0;

            document.getElementById('result').innerHTML = '';
            document.getElementById('resultArea').style.display = 'none';
            document.getElementById('loader').style.display = 'block';

            if (inputData && inputFile) {
                showAlert('–¢–∞ –∑”©–≤—Ö”©–Ω —Ç–µ–∫—Å—Ç —ç—Å–≤—ç–ª –∑—É—Ä–≥–∏–π–Ω –∞–ª—å –Ω—ç–≥–∏–π–≥ –æ—Ä—É—É–ª–Ω–∞ —É—É.', 'error');
                document.getElementById('loader').style.display = 'none';
                return;
            } else if (inputData) {
                data = inputData;
                inputSize = new Blob([data]).size;
            } else if (inputFile) {
                const fileType = inputFile.type;

                if (!fileType.startsWith("image/")) {
                    showAlert('–ó”©–≤—Ö”©–Ω –∑—É—Ä–∞–≥ –æ—Ä—É—É–ª–Ω–∞ —É—É (JPEG, PNG –≥—ç—Ö –º—ç—Ç).', 'error');
                    document.getElementById('loader').style.display = 'none';
                    return;
                }

                const reader = new FileReader();
                try {
                    data = await new Promise((resolve, reject) => {
                        reader.onload = () => resolve(reader.result.split(",")[1]); // Base64 encoded data
                        reader.onerror = () => reject("–ó—É—Ä–≥–∏–π–≥ —É–Ω—à–∏–∂ —á–∞–¥—Å–∞–Ω–≥“Ø–π.");
                        reader.readAsDataURL(inputFile);
                    });
                } catch (error) {
                    showAlert(error, 'error');
                    document.getElementById('loader').style.display = 'none';
                    return;
                }

                inputSize = inputFile.size;
            } else {
                showAlert('–¢–∞ —Ç–µ–∫—Å—Ç —ç—Å–≤—ç–ª –∑—É—Ä–∞–≥ –æ—Ä—É—É–ª–Ω–∞ —É—É.', 'error');
                document.getElementById('loader').style.display = 'none';
                return;
            }

            try {
                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = '';
                document.getElementById('resultArea').style.display = 'none';
                document.getElementById('loader').style.display = 'block';
                
                const response = await fetch('/compress', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data, algorithm }),
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }

                const result = await response.json();
                
                document.getElementById('loader').style.display = 'none';
                document.getElementById('resultArea').style.display = 'block';
                
                document.getElementById('algorithmBadge').textContent = algorithmName;
                
                document.getElementById('resultContainer').textContent = result.compressed;
                
                document.getElementById('originalSize').textContent = inputSize;
                document.getElementById('compressedSize').textContent = new Blob([result.compressed]).size;
                const compressionRatio = (inputSize / new Blob([result.compressed]).size).toFixed(2);
                document.getElementById('ratio').textContent = compressionRatio + 'x';
                
                if (result.tree) {
                    document.getElementById('treeVisualization').style.display = 'block';
                    document.getElementById('treeContent').textContent = JSON.stringify(result.tree, null, 2);
                } else {
                    document.getElementById('treeVisualization').style.display = 'none';
                }
                
                if (result.extra_info) {
                    document.getElementById('explanationSection').style.display = 'block';
                    document.getElementById('explanationContent').textContent = result.extra_info;
                } else {
                    document.getElementById('explanationSection').style.display = 'none';
                }

            } catch (error) {
                document.getElementById('loader').style.display = 'none';
                showAlert(`–ê–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞: ${error.message}`, 'error');
            }
        });

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    ${type === 'error' 
                        ? '<circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line>'
                        : '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline>'}
                </svg>
                ${message}
            `;
            
            const result = document.getElementById('result');
            result.innerHTML = '';
            result.appendChild(alertDiv);
            
            setTimeout(() => {
                if (result.contains(alertDiv)) {
                    result.removeChild(alertDiv);
                }
            }, 5000);
        }
    </script>
</body>

</html>